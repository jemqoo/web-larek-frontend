# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

### Базовый код сотоит из Api, Component, EventEmitter, Model

1. Класс Api элемент для взаимодействия с внешними API:
   возможность отправлять GET и POST-запросы;

2. Класс EventEmitter - Брокер событий который имеет возможность:
   "on" - Установить обработчик на событие;
   "off" - Снять обработчик с события;
   "emit" - Инициировать событие с данными;
   "onAll" - Слушать все события;
   "offAll" - Сбросить все обработчики;
   "trigger" - Сделать коллбек триггер, генерирующий событие при вызове;

3. Класс Component - базовый для других компонетов имеет возможность:
   "toggleClass" - Переключить класс;
   "setText" - Установить текстовое содержимое;
   "setDisabled" - Сменить статус блокировки;
   "setHidden/setVisible" - Скрыть/Показать елемент;
   "setImage" - Установить изображение с алтернативным текстом;
   "render" - Вернуть корневой DOM-элемент;

4. Класс Model - абстрактный базовый класс для всех моделей данных в проекте. Он предоставляет универсальную структуру для управления данными и их взаимодействием с системой событий.
   "emitChanges" - сообщает всем что модель поменялась;

### Компоненты модели данных:

1.  Класс AppData
    данный класс содержит состояние корзины, каталога товаров, заказа и ошибок валидации:

        basket: LotItem[] = [] - Содержит выбранные карточки в корзине;
        catalog: LotItem[] - Содержит в себе все карточки с сервера;
        "order: IOrder = {" - Обьект отвечающий за вывод данных на сервер;
        	"payment: ''," - Выбор способа оплаты;
        	"email: ' '," - электронная почта пользователя;
        	"phone: ' '," - телефон пользователя ;
        	"address: ''," - фдрес пользователя;
        	"total: 0," - Сумма общего заказа пользователя;
        	"items: [],};" - массив id, выбраных товарав;
        "formErrors: FormErrors = {}" - Отвечает за хранерие ошибок валидации;

Методы:
"setCatalog" - Добавляет данные товара в поле каталога;
"setBasket" - Добавляет данные товара в поле корзины;
"removeBasket" - Убирает конкретный товар из корзины;
"clearData" - Очищает всё корзину;
"getTotal" - Получает сумму заказа;
"setPreview" - Выводит карточки и добавляет id в поле "preview";
"getClosedLots" - Сортеровка карточек на повторения;
"validateOrder" - Проверка валидности "Order";
"setOrderField" - Устанавливает поле заказа и проверяет валидность;

Компоненты представления состоят из Basket, Form, Modal, Success, AuctionAPI, Card, Order, Page:

2. Класс Basket данный компонент предназначен для вывода контента в модальном окне Корзины, в данном компоненте содержатся следующие поля:
   list - HTML-элемент со списком товаров в корзине;
   total - HTML-элемент содержащий итоговую сумму заказа;
   button - HTML-элемент для открытия следующего модального окна;

Методы:
"set items(items: HTMLElement[])" - принимает список элементов и размещает их в list;
"set disabled(length: number)" - принимает аргументом длину списка товаров и разблокирует кнопку оформления;
"set total(price: number)" - устанавливает итоговую сумму в соответствующий HTML-элемент;

3. Класс Form данный компонент предназначен для форм приложения, в компонент имеет следующие поля:
   "submit" - HTML-элемент кнопки подтверждения формы;
   "errors" - HTML-элемент для вывода ошибок валидации;

Методы:
"onInputChange(field: keyof T, value: string)" - Отвечает за вывод ошибки в разметку;
"set valid(value: boolean)" - Для блокировки/разблокировки кнопки подтверждения;
"set errors(value: string)" - Установки сообщения об ошибке;
"render(state: Partial<T> & IFormState)" - вызывает родительский метод;

4. Класс Modal данный компонент отвечает за работу модальных окон и вывод в них контента, в данном компоненте содержатся следующие поля:
   "closeButton" - HTML-элемент кнопки закрытия модального окна;
   "content" - HTML-элемент с контентом.

Методы:
"open" - открытия модального окна;
"close" - закрытия модального окна;
"render(data: IModalData)" - вызывает родительский метод и открывает модальное окно с отрисованным контентом;

5. Класс Success данный компонент предназначен для отображения окна с уведомлением об успешном заказе, в данном компоненте содержатся следующие поля:
   "description" - HTML-элемент, содержащий текст с количеством списанных средств;
   "close" - HTML-элемент кнопки закрытия окна

Методы:
"set description(value: number)" - Устанавка текста цены заказа;

6. Класс LarekAPI расширяет базовый класс Api, данный компонент предоставляет методы для работы с API, обеспечивает функциональность для получения списка карточек, информации о продуктах и оформления заказов.

Методы:
"getLotList" - Получить данные списока товаров с сервера;
"getLotItem" - Получить данные конкретного товара по его ID;
"orderLots" - Отправить данные заказа;

7. Класс Card данный компонент предназначен вывода данных о товаре на страницу,
   в данном компоненте содержатся следующие поля:
   category: string;
   title: string;
   description?: string | string[];
   image: string;
   price: string | number;
   itemIndex: number

Методы:
"set/get id(value: string)" - для установки/получения id в соответвующие элементы на страницы;
"set/get title(value: string)" - для установки/получения title в соответвующие элементы на страницы;
"set/get price(value: string)" - для установки/получения price в соответвующие элементы на страницы;

8. Класс OrderForm данный компонент предназначен для работы с формой "Order", в данном компоненте содержатся следующие поля:
   button - HTML-элемент для открытия следующего модального окна;
   buttonCash - HTML-элемент кнопки "онлайн";
   buttonCard - HTML-элемент кнопки "При получении";
   address - HTML-элемент с инпутом для ввода адреса

Методы:
"isSelected" - Данные о выбранной кнопки;
"set address(value: string)" - Установка адреса доставки;
"getAddress" - проверка адреса;
"clearOrder" - очистка поля адреса и выбора способа оплаты;

9. Класс ContactForm данный компонент предназначен для работы с формой "contacts",имеет следующие поля:

email - HTML-элемент с инпутом для ввода электронной почты
phone - HTML-элемент с инпутом для ввода номера телефона

Методы:
"set phone(value: string)" - Установка номера телефона;
"set email(value: string)" - Установка адреса электронной почты;
"isEmail" - Проверка на наличие значения в инпуте;
"isPhone" - Проверка на наличие значения в инпуте;
"clearContact" - очистка поля телефона и электроной почты;

10. Класс Page данный компонент предназначен вывода основных данных на страницу, компонент имеет следующие поля:
    "counter" - HTML-элемент счетчика количества товаров в корзине;
    "catalog" - HTML-элемент галереи с товарами;
    "wrapper" - HTML-элемент основного контейнер всей страницы;
    "basket" - HTML-элемент кнопки корзины;

Методы:
"counter" - Установка количества карточек на страницу, в корзину;
"catalog" - Установки содержимого в соответвующие элементы на страницу;
"locked" - Блокируем прокрутку страницы если открыта модалка;

### Интерфейсы

// интерфейс, описывающий карточку товара
export interface ILotItem {
id: string;
title: string;
category: string;
description?: string;
image: string;
price: string | number;
}

// интерфейс модели приложения
export interface IAppState {
catalog: ILotItem[];
basket: string[];
order: IOrder | null;
}

// Интерфейс для формы заказа
export interface IOrderForm {
payment: string;
email: string;
phone: string;
address: string;
total: number;
items: string[];
}

// Интерфейс для контактной формы
export interface IContactForm {
email: string;
phone: string;
}

//Интерфейс для формы
export interface IOrder extends IOrderForm {
total: number;
items: string[];
}

### Cписок основных событий:

Изначально с сервера получаем данные о карточках. После этого происходит событие "items:changed", и карточки отображаются на странице.

При клике на карточку, срабатывают события "card:select" и "preview:changed", и открывается модальное окно с подробной информацией о карточке (событие "modal:open").

При нажатии кнопки "в корзину" в открытом модальном окне карточки, происходит добавление этой карточки в поле "basket" класса "AppData" (событие "basket:add" и "basket:changed"), а затем модальное окно закрывается (событие "modal:close").

При нажатии на иконку корзины в верхнем правом углу страницы, срабатывают события "basket:changed" и "basket:open", и открывается модальное окно корзины (событие "modal:open").

При нажатии на иконку удаления карточки в модальном окне корзины, срабатывают события "basket:remove" и "basket:changed", и карточка удаляется из корзины.

При нажатии кнопки "Оформить" в открытом модальном окне корзины, срабатывают события "order:open" и "formErrors:change", и открывается модальное окно "Order" (событие "modal:open").

При выборе способа оплаты через кнопки "Отлайн" и "При получении" в модальном окне "Order", срабатывает событие "order:changed", и данные формы обновляются.

При вводе адреса доставки в поле "address" в модальном окне "Order", срабатывают события "order:changed", "order.address:change" и "formErrors:change", и происходит проверка на валидность поля ввода.

При правильном заполнении способа оплаты и адреса доставки, срабатывает событие "order:ready", и кнопка "Далее" становится активной.

При нажатии кнопки "Далее", срабатывают события "order:submit" и "formErrors:change", и открывается модальное окно "Contacts".

При вводе электронной почты в поле "email" в модальном окне "Contacts", срабатывают события "contacts:changed", "contacts.email:change" и "formErrors:change", и происходит обновление данных формы и проверка на валидность.

При вводе номера телефона в поле "phone" в модальном окне "Contacts", срабатывают события "contacts:changed", "contacts.phone:change" и "formErrors:change", и происходит проверка на валидность поля ввода.

При правильном заполнении электронной почты и телефона, срабатывает событие "contacts:changed", и кнопка "Оплатить" становится активной.

При нажатии кнопки "Оплатить", срабатывает событие "contacts:submit", и открывается модальное окно с подтверждением покупки (событие "modal:open").
